(()=>{"use strict";const e=window.wp.hooks,t=window.wp.compose,i=window.wp.element,r=window.wp.blockEditor,a=window.wp.components,d=window.wp.i18n,n=window.ReactJSXRuntime;(0,e.addFilter)("blocks.registerBlockType","mai-media-credit/register-attribute",(e,t)=>("core/image"===t&&(e.attributes={...e.attributes,mediaCredit:{type:"string",default:""}}),e));const c=(0,t.createHigherOrderComponent)(e=>t=>{if("core/image"!==t.name)return(0,n.jsx)(e,{...t});const{attributes:c,setAttributes:o}=t,[s,m]=(0,i.useState)(""),[l,p]=(0,i.useState)(!1),u=(0,i.useRef)(null),w=c.id||null;(0,i.useEffect)(()=>{w?h(w):(m(""),o({mediaCredit:""}))},[w]),(0,i.useEffect)(()=>{w&&!c.mediaCredit&&h(w)},[]),(0,i.useEffect)(()=>()=>{u.current&&clearTimeout(u.current)},[]);const h=async e=>{if(e){p(!0);try{const t=new FormData;t.append("action","get_media_credit"),t.append("attachment_id",e),t.append("nonce",maiMediaCredit.nonce);const i=await fetch(maiMediaCredit.ajaxUrl,{method:"POST",body:t}),r=await i.json();if(r.success){const e=r.data.media_credit||"";m(e),o({mediaCredit:e})}}catch(e){console.error("Error loading media credit:",e),m(""),o({mediaCredit:""})}finally{p(!1)}}};return(0,n.jsxs)(i.Fragment,{children:[(0,n.jsx)(e,{...t}),(0,n.jsx)(r.InspectorControls,{children:(0,n.jsx)("div",{style:{paddingLeft:"16px",paddingRight:"16px"},children:(0,n.jsx)(a.TextControl,{label:(0,d.__)("Media Credit","mai-media-credit"),help:(0,d.__)("Enter the attribution/credit for this image.","mai-media-credit"),value:s||"",onChange:e=>{m(e),o({mediaCredit:e}),u.current&&clearTimeout(u.current),u.current=setTimeout(()=>{w&&(async e=>{if(w){p(!0);try{const t=new FormData;t.append("action","save_media_credit"),t.append("attachment_id",w),t.append("media_credit",e),t.append("nonce",maiMediaCredit.nonce);const i=await fetch(maiMediaCredit.ajaxUrl,{method:"POST",body:t}),r=await i.json();r.success||console.error("Error saving media credit:",r)}catch(e){console.error("Error saving media credit:",e)}finally{p(!1)}}})(e)},500)},disabled:!w,placeholder:w?(0,d.__)("Enter media credit...","mai-media-credit"):(0,d.__)("Select an image first","mai-media-credit")})})})]})},"withMediaCredit");(0,e.addFilter)("editor.BlockEdit","mai-media-credit/with-media-credit",c);const o=(0,t.createHigherOrderComponent)(e=>t=>{if("core/image"!==t.name)return(0,n.jsx)(e,{...t});if(!t.attributes.mediaCredit)return(0,n.jsx)(e,{...t});const i={...t.wrapperProps,"data-media-credit":t.attributes.mediaCredit};return(0,n.jsx)(e,{...t,wrapperProps:i})},"addMediaCreditAttribute");(0,e.addFilter)("editor.BlockListBlock","mai-media-credit/add-media-credit-attribute",o)})();